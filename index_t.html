<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTA Datavis Sketch</title>
    <script src="./node_modules/p5/lib/p5.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <style>
        main { display: none; }
        pre {
            background: white;
            width: 100dvw;
            height: 100dvh;
            white-space: pre-wrap;
            overflow-y: scroll;
        }
    </style>
    <pre id="console"></pre>
    
    <script type="module">
        // Testing preload with async/await 
        
        import util from './util.mjs';
        
        
        function delay(duration = 3000) {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(true);
                }, duration);
            });
        }
        
        async function preload() {
            // console.log(self);
            self._incrementPreload();
            await delay(3000);
            self._decrementPreload();
            
            console.log('done preloading');
        }
        
        // const loadingPromise = delay(5000);
        
        async function setup() {
            frameRate(1);
            // noLoop();
            await delay(3000);
            console.log('setup finished');
        }
        
        async function draw() {
            console.log(frameCount);
        }
        
        util.register_global(preload,setup, draw);
        
        /*
            draw() runs without createCanvas();
            noLoop() in setup causes draw to run one time
            await within setup() does wait
            await within draw() does wait
            await within preload() doew wait
            but draw() doesn't wait on awaited promises in setup
            
            self._incrementPreload() and self._decrementPreload() work withing preload()
            
            window._incrementPreload() or this._incrementPreload() do work
            but _incrementPreload() doesn't
        */
        
    </script>
</body>
</html>