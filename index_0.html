<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTA Datavis Sketch</title>
    <script src="./node_modules/p5/lib/p5.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <style>
        main { display: none; }
        pre {
            background: white;
            width: 100dvw;
            height: 100dvh;
            white-space: pre-wrap;
            overflow-y: scroll;
        }
    </style>
    <pre id="console"></pre>
    
    <script type="module">
        
        // --------------------------------------------------------------------------------
        
        import data from './data.mjs'
        import util from './util.mjs';
        
        let sample_idx = 0; // current sample index
        
        const orig_log = console.log;
        
        //https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value
        function getCircularReplacer() {
          const ancestors = [];
          return function (key, value) {
            if (typeof value !== "object" || value === null) {
              return value;
            }
            // `this` is the object that value is contained in,
            // i.e., its direct parent.
            while (ancestors.length > 0 && ancestors.at(-1) !== this) {
              ancestors.pop();
            }
            if (ancestors.includes(value)) {
              return "[Circular]";
            }
            ancestors.push(value);
            return value;
          };
        }
        
        function my_log(...str) {
            orig_log(...str);
            str = str.map((el) => {
                if (typeof el == 'object') return JSON.stringify(el, getCircularReplacer(), 2);
                return el
            });
            document.querySelector("#console").textContent += str.join(" ") + "\n";
        }
        console.log = my_log;
    
        async function setup() {
            // createCanvas(100, 100);
            noLoop();
            pixelDensity(1);
            
            await data.load('./data/dataMartin.csv');
            orig_log(data.raw());
            
            const stats = data.get_stats();
            console.log(stats);
        }
        
        util.register_global(setup)
        
    </script>
</body>
</html>